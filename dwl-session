#!/bin/sh
set -e
maybe() {
    command -v "$1" > /dev/null && "$@"
}

if [ "$1" = 'startup' ]; then
    trap "trap - TERM && kill -- -$$" INT TERM EXIT

    # this is hell
    dbus-update-activation-environment --systemd \
        WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

    maybe /usr/lib/x86_64-linux-gnu/libexec/kdeconnectd &
    maybe spectacle -s &
    maybe ~/.local/lib/pulseaudio-watch someblocks &
    null-notifyd &
    somebar &
    someblocks &

    while read -r dummy; do
        :
    done
else
    export QT_QPA_PLATFORM=wayland
    export XDG_CURRENT_DESKTOP=wlroots
    exec dwl -s "setsid -w $0 startup"
fi
